function prepareDom(){var e="",t="",n="";for(i=0;i<players.length;i++){players[i].dealer===!1&&(t='<a href="#" class="stand">Stand</a><a href="#" class="hit">Hit</a>');e=before+'class="cards">'+after;n+=before+' class="'+players[i].cssClass+' hand">'+e+t+after}$(".playing-surface").append(n)}function flipCard(e,t){if(e.dealer===!1||e.hand.length>0)t.faceUp=!0;return t}function deal(e,t){var n,r;if(deck.length>0){if(arguments.length===1)for(k=0;k<e;k++)for(i=0;i<players.length;i++){r=deck.pop();n=players[i].hand;flipCard(players[i],r);n[n.length]=r}else for(k=0;k<e;k++){r=deck.pop();flipCard(t,r);t.hand[t.hand.length]=r}render()}}function render(){for(i=0;i<players.length;i++){cardEls="";for(j=0;j<players[i].hand.length;j++){var e=players[i].hand[j],t=' data-faceUp="'+e.faceUp+'";',n=' class="'+e.suit+' card "> ',r=e.rank,s=e.symbol;cardEls+=before+t+n+r+s+after}$(players[i].selector+" .cards").html(cardEls)}}function matchPlayer(e){var t=e.parent().attr("class").split(" ")[0],n,r=null;for(n=0;n<players.length;n++)players[n].cssClass==t&&(r=players[n]);return r}function resetGame(){$(".playing-surface").html("");players=[]}var Card=function(e,t){this.rank=e;this.value=this.values[this.rank];this.suit=t;this.symbol=this.symbols[this.suit];this.faceUp=!1};Card.prototype.symbols={H:"❤",S:"♠",D:"♦",C:"♣"};Card.prototype.values={2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:10,Q:10,K:10,A:11};Card.prototype.toString=function(){return this.rank+" of "+this.suit};var Player=function(e,t,n){this.hand=e;this.selector=t;this.cssClass=t.substr(1);this.dealer=n},players=[],createPlayers=function(e){players[0]=new Player([],".dealer",!0);var t;for(t=1;t<e+1;t++)players[t]=new Player([],".player"+t,!1)},deck=[],createDeck=function(e){var t=["C","S","D","H"],n=["A","K","Q","J","10","9","8","7","6","5","4","3","2"],r,i,s,o=n.length;for(r=0;r<e;r++)for(i=0;i<t.length;i++)for(s=0;s<o;s++)deck[deck.length]=new Card(n[s],t[i])},shuffle=function(){var e,t;for(i=0;i<deck.length;i++){e=Math.floor(Math.random()*deck.length);t=deck[i];deck[i]=deck[e];deck[e]=t}},before="<div ",after="</div>";$(document).ready(function(){$("#new-game").on("click",function(){resetGame();createPlayers(parseInt($(".control-bar select").val(),10));prepareDom();createDeck(1);shuffle();deal(2)});$(".hit").live("click",function(){var e=$(this);deal(1,matchPlayer(e))})});